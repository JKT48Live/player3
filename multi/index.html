<!DOCTYPE html>
<html>
<head>
    <title>Streaming M3U dengan HLS.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        #video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            grid-gap: 10px;
            height: 100vh;
        }

        .video-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .delete-button {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            opacity: 0.5;
        }

        .mode-switch-container {
            display: flex;
            align-items: center;
        }

        .mode-switch-container .form-control {
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            #video-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr 1fr 1fr;
                height: auto;
            }
        }

        body.dark-mode {
            background-color: #333;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form id="m3u-form">
                    <div class="input-group mb-3">
                        <div class="mode-switch-container">
                            <a id="mode-switch" class="btn btn-light">
                                <i class="fas fa-moon"></i>
                            </a>
                        </div>
                        <input type="text" id="m3u-link" name="m3u-link" class="form-control" placeholder="Masukkan link M3U">
                        <button type="submit" id="add-button" class="btn btn-primary">Tambah Video</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="video-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const MAX_VIDEOS = 4;
        let currentVideoCount = 0;

        function createVideoElement() {
            const videoWrapper = document.createElement('div');
            videoWrapper.className = 'video-wrapper';

            const video = document.createElement('video');
            video.controls = true;
            videoWrapper.appendChild(video);

            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn btn-danger delete-button';
            deleteButton.textContent = 'X';
            deleteButton.addEventListener('click', function() {
                deleteVideo(videoWrapper);
            });
            videoWrapper.appendChild(deleteButton);

            return { videoWrapper, video };
        }

        function addVideoFromInput(linkInput) {
            const linkValue = linkInput.value.trim(); // Menghapus spasi di awal dan akhir input

            if (linkValue === '') {
                alert('Link M3U tidak boleh kosong');
                return;
            }

            if (currentVideoCount >= MAX_VIDEOS) {
                alert('Maksimal 4 video telah dicapai');
                return;
            }

            const { videoWrapper, video } = createVideoElement();
            const videoContainer = document.getElementById('video-container');
            videoContainer.appendChild(videoWrapper);

            const hls = new Hls();
            hls.loadSource(linkValue);
            hls.attachMedia(video);

            currentVideoCount++;

            if (currentVideoCount >= MAX_VIDEOS) {
                document.getElementById('add-button').disabled = true;
            }

            linkInput.value = '';
        }

        function deleteVideo(videoWrapper) {
            const videoContainer = document.getElementById('video-container');
            videoContainer.removeChild(videoWrapper);
            currentVideoCount--;

            if (currentVideoCount < MAX_VIDEOS) {
                document.getElementById('add-button').disabled = false;
            }
        }

        function initialize() {
            const form = document.getElementById('m3u-form');
            const linkInput = document.getElementById('m3u-link');
            const modeSwitch = document.getElementById('mode-switch');
            const body = document.body;

            form.addEventListener('submit', function(event) {
                event.preventDefault();
                addVideoFromInput(linkInput);
            });

            modeSwitch.addEventListener('click', function() {
                body.classList.toggle('dark-mode');
                modeSwitch.classList.toggle('btn-light');
                modeSwitch.classList.toggle('btn-dark');
                modeSwitch.innerHTML = body.classList.contains('dark-mode') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            });
        }

        initialize();
    </script>
</body>
</html>